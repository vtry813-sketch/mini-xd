<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  <title>INCONNU XD | WhatsApp Pairing</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', sans-serif;
      background: linear-gradient(145deg, #0b0f1a 0%, #1a1f2e 100%);
      color: #ffffff;
      min-height: 100vh;
      position: relative;
      overflow-x: hidden;
    }

    /* Animated Background */
    .gradient-bg {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: 
        radial-gradient(circle at 20% 50%, rgba(76, 201, 240, 0.05) 0%, transparent 50%),
        radial-gradient(circle at 80% 80%, rgba(67, 97, 238, 0.05) 0%, transparent 50%);
      pointer-events: none;
      z-index: 0;
    }

    .grid-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-image: 
        linear-gradient(rgba(76, 201, 240, 0.03) 1px, transparent 1px),
        linear-gradient(90deg, rgba(76, 201, 240, 0.03) 1px, transparent 1px);
      background-size: 50px 50px;
      pointer-events: none;
      z-index: 1;
    }

    /* Floating Orbs */
    .orb {
      position: fixed;
      border-radius: 50%;
      filter: blur(80px);
      z-index: 0;
    }

    .orb-1 {
      top: -100px;
      right: -100px;
      width: 400px;
      height: 400px;
      background: radial-gradient(circle, rgba(76, 201, 240, 0.15), transparent 70%);
      animation: float 20s ease-in-out infinite;
    }

    .orb-2 {
      bottom: -100px;
      left: -100px;
      width: 500px;
      height: 500px;
      background: radial-gradient(circle, rgba(67, 97, 238, 0.12), transparent 70%);
      animation: float 25s ease-in-out infinite reverse;
    }

    @keyframes float {
      0%, 100% { transform: translate(0, 0); }
      50% { transform: translate(50px, 50px); }
    }

    /* Main Container */
    .container {
      position: relative;
      z-index: 10;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    /* Card */
    .card {
      width: 100%;
      max-width: 520px;
      background: rgba(18, 22, 36, 0.9);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.06);
      border-radius: 36px;
      padding: 45px 35px;
      box-shadow: 
        0 30px 80px rgba(0, 0, 0, 0.5),
        0 0 0 1px rgba(255, 255, 255, 0.02) inset;
      position: relative;
      overflow: hidden;
      animation: cardAppear 0.9s cubic-bezier(0.23, 1, 0.32, 1);
    }

    @keyframes cardAppear {
      0% {
        opacity: 0;
        transform: translateY(40px) scale(0.96);
      }
      100% {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }

    /* Card Shine Effect */
    .card::after {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle at 70% 30%, rgba(255, 255, 255, 0.03), transparent 50%);
      pointer-events: none;
    }

    /* Header */
    .header {
      text-align: center;
      margin-bottom: 35px;
      position: relative;
    }

    .logo {
      width: 90px;
      height: 90px;
      margin: 0 auto 20px;
      background: linear-gradient(135deg, #4cc9f0, #4361ee);
      border-radius: 28px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 38px;
      color: white;
      box-shadow: 
        0 15px 35px rgba(76, 201, 240, 0.3),
        0 0 0 2px rgba(255, 255, 255, 0.05) inset;
      transform: rotate(3deg);
      transition: transform 0.3s ease;
    }

    .logo:hover {
      transform: rotate(0deg);
    }

    .title {
      font-size: 36px;
      font-weight: 800;
      background: linear-gradient(135deg, #4cc9f0, #a78bfa, #4361ee);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      letter-spacing: -0.5px;
      margin-bottom: 8px;
    }

    .subtitle {
      font-size: 15px;
      color: #a0a8c0;
      font-weight: 400;
      letter-spacing: 0.3px;
    }

    /* Server Card */
    .server-card {
      background: rgba(255, 255, 255, 0.03);
      border: 1px solid rgba(255, 255, 255, 0.05);
      border-radius: 24px;
      padding: 22px;
      margin-bottom: 25px;
      display: flex;
      align-items: center;
      gap: 18px;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .server-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.02), transparent);
      transition: left 0.6s ease;
    }

    .server-card:hover::before {
      left: 100%;
    }

    .server-card:hover {
      border-color: rgba(76, 201, 240, 0.2);
      transform: translateY(-2px);
    }

    .server-icon {
      width: 60px;
      height: 60px;
      background: linear-gradient(135deg, rgba(76, 201, 240, 0.15), rgba(67, 97, 238, 0.15));
      border-radius: 18px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 26px;
      color: #4cc9f0;
      border: 1px solid rgba(76, 201, 240, 0.2);
    }

    .server-details {
      flex: 1;
    }

    .server-name {
      font-size: 18px;
      font-weight: 700;
      margin-bottom: 8px;
      color: #fff;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .badge {
      background: rgba(76, 201, 240, 0.15);
      color: #4cc9f0;
      font-size: 11px;
      font-weight: 600;
      padding: 4px 10px;
      border-radius: 30px;
      border: 1px solid rgba(76, 201, 240, 0.3);
    }

    .server-stats {
      display: flex;
      gap: 20px;
    }

    .stat {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 13px;
      color: #a0a8c0;
    }

    .stat i {
      color: #4cc9f0;
      font-size: 10px;
    }

    /* Sessions Panel */
    .sessions-panel {
      background: rgba(0, 0, 0, 0.2);
      border-radius: 24px;
      padding: 20px;
      margin-bottom: 25px;
      border: 1px solid rgba(255, 255, 255, 0.03);
    }

    .panel-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }

    .panel-title {
      font-size: 15px;
      font-weight: 600;
      color: #a0a8c0;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .refresh-btn {
      background: transparent;
      border: none;
      color: #4cc9f0;
      width: 36px;
      height: 36px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 14px;
    }

    .refresh-btn:hover {
      background: rgba(76, 201, 240, 0.1);
      transform: rotate(180deg);
    }

    .sessions-list {
      max-height: 200px;
      overflow-y: auto;
    }

    .session-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 0;
      border-bottom: 1px solid rgba(255, 255, 255, 0.03);
    }

    .session-item:last-child {
      border-bottom: none;
    }

    .session-id {
      font-family: 'Monaco', 'Monospace', monospace;
      font-size: 13px;
      color: #e0e4f0;
    }

    .status-badge {
      font-size: 11px;
      padding: 4px 12px;
      border-radius: 30px;
      font-weight: 600;
    }

    .status-running {
      background: rgba(0, 212, 170, 0.15);
      color: #00d4aa;
      border: 1px solid rgba(0, 212, 170, 0.2);
    }

    /* Info Box */
    .info-box {
      background: rgba(76, 201, 240, 0.03);
      border: 1px solid rgba(76, 201, 240, 0.1);
      border-radius: 24px;
      padding: 22px;
      margin-bottom: 25px;
      display: flex;
      gap: 15px;
    }

    .info-icon {
      color: #4cc9f0;
      font-size: 22px;
      flex-shrink: 0;
    }

    .info-content h4 {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 8px;
      color: #fff;
    }

    .info-content p {
      font-size: 14px;
      color: #a0a8c0;
      line-height: 1.6;
    }

    /* Form */
    .form-group {
      margin-bottom: 25px;
    }

    .label {
      display: block;
      margin-bottom: 12px;
      font-size: 14px;
      font-weight: 600;
      color: #a0a8c0;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .input-wrapper {
      position: relative;
    }

    .input {
      width: 100%;
      padding: 18px 20px 18px 55px;
      background: rgba(255, 255, 255, 0.03);
      border: 2px solid rgba(255, 255, 255, 0.05);
      border-radius: 20px;
      color: white;
      font-size: 16px;
      font-family: inherit;
      transition: all 0.3s ease;
    }

    .input:focus {
      outline: none;
      border-color: #4cc9f0;
      background: rgba(255, 255, 255, 0.05);
      box-shadow: 0 0 0 4px rgba(76, 201, 240, 0.1);
    }

    .input-icon {
      position: absolute;
      left: 20px;
      top: 50%;
      transform: translateY(-50%);
      color: #4cc9f0;
      font-size: 18px;
      opacity: 0.5;
    }

    .hint {
      font-size: 13px;
      color: #a0a8c0;
      margin-top: 10px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    /* Button */
    .btn {
      width: 100%;
      padding: 18px;
      border: none;
      border-radius: 20px;
      font-size: 16px;
      font-weight: 600;
      font-family: inherit;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      position: relative;
      overflow: hidden;
    }

    .btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
      transition: left 0.6s;
    }

    .btn:hover::before {
      left: 100%;
    }

    .btn-primary {
      background: linear-gradient(135deg, #4cc9f0, #4361ee);
      color: white;
      box-shadow: 0 10px 25px rgba(76, 201, 240, 0.3);
      margin-bottom: 15px;
    }

    .btn-primary:hover:not(:disabled) {
      transform: translateY(-3px);
      box-shadow: 0 15px 35px rgba(76, 201, 240, 0.4);
    }

    .btn-primary:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .btn-secondary {
      background: rgba(255, 255, 255, 0.03);
      border: 1px solid rgba(255, 255, 255, 0.1);
      color: white;
      display: none;
    }

    .btn-secondary:hover {
      background: rgba(255, 255, 255, 0.05);
    }

    /* Code Box */
    .code-box {
      background: rgba(0, 0, 0, 0.3);
      border: 2px solid rgba(255, 255, 255, 0.05);
      border-radius: 20px;
      padding: 25px;
      margin-bottom: 15px;
      text-align: center;
      min-height: 100px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
    }

    .code-box.has-code {
      border-color: rgba(0, 212, 170, 0.3);
      background: rgba(0, 212, 170, 0.03);
    }

    .code-box.has-error {
      border-color: rgba(255, 107, 107, 0.3);
      background: rgba(255, 107, 107, 0.03);
    }

    .code-placeholder {
      color: #a0a8c0;
      font-size: 15px;
    }

    .code-value {
      font-size: 32px;
      font-weight: 700;
      letter-spacing: 4px;
      color: #00d4aa;
      font-family: 'Monaco', 'Monospace', monospace;
    }

    .error-message {
      color: #ff6b6b;
      font-size: 15px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    /* Loading */
    .loading {
      display: none;
      text-align: center;
      margin: 20px 0;
    }

    .spinner {
      width: 50px;
      height: 50px;
      border: 3px solid rgba(76, 201, 240, 0.1);
      border-radius: 50%;
      border-top-color: #4cc9f0;
      animation: spin 1s linear infinite;
      margin: 0 auto 15px;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Social Links */
    .social-links {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin-top: 30px;
      padding-top: 25px;
      border-top: 1px solid rgba(255, 255, 255, 0.05);
    }

    .social-link {
      width: 48px;
      height: 48px;
      border-radius: 16px;
      background: rgba(255, 255, 255, 0.02);
      border: 1px solid rgba(255, 255, 255, 0.05);
      display: flex;
      align-items: center;
      justify-content: center;
      color: #a0a8c0;
      font-size: 20px;
      text-decoration: none;
      transition: all 0.3s ease;
    }

    .social-link:hover {
      background: rgba(76, 201, 240, 0.1);
      color: #4cc9f0;
      transform: translateY(-3px);
      border-color: rgba(76, 201, 240, 0.2);
    }

    /* Footer */
    .footer {
      text-align: center;
      margin-top: 25px;
      font-size: 13px;
      color: #a0a8c0;
    }

    .highlight {
      color: #4cc9f0;
      font-weight: 600;
    }

    .dev-name {
      color: #f472b6;
      font-weight: 600;
    }

    /* Toast */
    .toast {
      position: fixed;
      bottom: 30px;
      left: 50%;
      transform: translateX(-50%) translateY(100px);
      background: linear-gradient(135deg, #1a1f2e, #0b0f1a);
      border: 1px solid rgba(76, 201, 240, 0.2);
      color: white;
      padding: 16px 28px;
      border-radius: 60px;
      font-weight: 500;
      box-shadow: 0 15px 35px rgba(0, 0, 0, 0.5);
      transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
      z-index: 1000;
      opacity: 0;
      display: flex;
      align-items: center;
      gap: 12px;
      font-size: 14px;
      backdrop-filter: blur(10px);
    }

    .toast.show {
      transform: translateX(-50%) translateY(0);
      opacity: 1;
    }

    .toast.error {
      border-color: rgba(255, 107, 107, 0.3);
    }

    /* Scrollbar */
    ::-webkit-scrollbar {
      width: 6px;
    }

    ::-webkit-scrollbar-track {
      background: rgba(255, 255, 255, 0.02);
      border-radius: 10px;
    }

    ::-webkit-scrollbar-thumb {
      background: rgba(76, 201, 240, 0.3);
      border-radius: 10px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: rgba(76, 201, 240, 0.5);
    }

    /* Responsive */
    @media (max-width: 500px) {
      .card {
        padding: 30px 20px;
      }

      .title {
        font-size: 30px;
      }

      .code-value {
        font-size: 26px;
      }

      .server-card {
        flex-direction: column;
        text-align: center;
      }

      .server-stats {
        justify-content: center;
      }
    }
  </style>
</head>
<body>
  <div class="gradient-bg"></div>
  <div class="grid-overlay"></div>
  <div class="orb orb-1"></div>
  <div class="orb orb-2"></div>

  <div class="container">
    <div class="card">
      <div class="header">
        <div class="logo">
          <i class="fas fa-bolt"></i>
        </div>
        <h1 class="title">INCONNU XD</h1>
        <p class="subtitle">WhatsApp Pairing System • Professional Edition</p>
      </div>

      <!-- Server Card -->
      <div class="server-card" id="serverCard">
        <div class="server-icon">
          <i class="fas fa-shield-alt"></i>
        </div>
        <div class="server-details">
          <div class="server-name">
            Main Server
            <span class="badge">Primary</span>
          </div>
          <div class="server-stats">
            <div class="stat" id="activeCount">
              <i class="fas fa-circle"></i>
              <span>Active: --</span>
            </div>
            <div class="stat" id="capacityDisplay">
              <i class="fas fa-users"></i>
              <span>Capacity: --</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Sessions Panel -->
      <div class="sessions-panel">
        <div class="panel-header">
          <div class="panel-title">
            <i class="fas fa-list"></i>
            Active Sessions
          </div>
          <button class="refresh-btn" id="refreshBtn">
            <i class="fas fa-sync-alt"></i>
          </button>
        </div>
        <div class="sessions-list" id="sessionsList">
          <div style="text-align: center; padding: 20px; color: #a0a8c0;">
            <i class="fas fa-spinner fa-spin"></i> Loading...
          </div>
        </div>
      </div>

      <!-- Info Box -->
      <div class="info-box">
        <div class="info-icon">
          <i class="fas fa-info-circle"></i>
        </div>
        <div class="info-content">
          <h4>How to Pair</h4>
          <p>Enter your WhatsApp number (without +), click generate, then use the code in WhatsApp → Linked Devices → Link a device → Pair using code</p>
        </div>
      </div>

      <!-- Form -->
      <form id="pairForm">
        <div class="form-group">
          <label class="label">
            <i class="fas fa-phone-alt"></i>
            Phone Number
          </label>
          <div class="input-wrapper">
            <input 
              type="text" 
              id="phoneNumber" 
              class="input" 
              placeholder="5511999999999"
              pattern="[0-9]+"
              inputmode="numeric"
              required
            >
            <i class="fas fa-hashtag input-icon"></i>
          </div>
          <div class="hint">
            <i class="fas fa-lightbulb"></i>
            Enter without + or spaces (e.g., 5511999999999)
          </div>
        </div>

        <button type="submit" class="btn btn-primary" id="generateBtn">
          <i class="fas fa-key"></i>
          Generate Pair Code
        </button>

        <div class="loading" id="loading">
          <div class="spinner"></div>
          <p class="loading-text">Generating code...</p>
        </div>

        <div class="code-box" id="codeBox">
          <div class="code-placeholder">Code will appear here</div>
        </div>

        <button type="button" class="btn btn-secondary" id="copyBtn">
          <i class="fas fa-copy"></i>
          Copy Code
        </button>
      </form>

      <!-- Social Links -->
      <div class="social-links">
        <a href="https://whatsapp.com/channel/0029VbC6It7K0IBkQwaKYd2J" target="_blank" class="social-link">
          <i class="fab fa-whatsapp"></i>
        </a>
        <a href="https://chat.whatsapp.com/HVdyhSroS6h3HoCbankB8X" target="_blank" class="social-link">
          <i class="fas fa-comments"></i>
        </a>
        <a href="https://youtu.be/n09eZbKexQY" target="_blank" class="social-link">
          <i class="fab fa-youtube"></i>
        </a>
        <a href="https://t.me/+f5MXTmwwdeU2Y2Ux" target="_blank" class="social-link">
          <i class="fab fa-telegram"></i>
        </a>
      </div>

      <!-- Footer -->
      <div class="footer">
        <p>© 2026 <span class="highlight">INCONNU XD</span> • Created with <i class="fas fa-heart" style="color: #f472b6; font-size: 12px;"></i> by <span class="dev-name">Dev Inconnu Boy</span></p>
      </div>
    </div>
  </div>

  <!-- Toast -->
  <div class="toast" id="toast">
    <i class="fas fa-check-circle"></i>
    <span>Code copied successfully</span>
  </div>

  <script>
    // Configuration - Single Server
    const SERVER = {
      id: 'main',
      name: 'Main Server',
      url: 'http://157.230.133.89:2001/pair/',
      maxSessions: 25,
      activeSessions: 0,
      isFull: false
    };

    // State
    let currentServer = SERVER;
    let currentCode = null;
    let isLoadingSessions = false;

    // DOM Elements
    const phoneInput = document.getElementById('phoneNumber');
    const generateBtn = document.getElementById('generateBtn');
    const loading = document.getElementById('loading');
    const codeBox = document.getElementById('codeBox');
    const copyBtn = document.getElementById('copyBtn');
    const toast = document.getElementById('toast');
    const form = document.getElementById('pairForm');
    const activeCount = document.getElementById('activeCount');
    const capacityDisplay = document.getElementById('capacityDisplay');
    const sessionsList = document.getElementById('sessionsList');
    const refreshBtn = document.getElementById('refreshBtn');
    const serverCard = document.getElementById('serverCard');

    // Validation
    function validatePhone(number) {
      const cleaned = number.replace(/[^\d]/g, '');
      return cleaned.length >= 6 && cleaned.length <= 15 && /^\d+$/.test(cleaned);
    }

    // Toast
    function showToast(message, isError = false) {
      const toastIcon = toast.querySelector('i');
      const toastText = toast.querySelector('span');
      
      toastIcon.className = isError ? 'fas fa-exclamation-circle' : 'fas fa-check-circle';
      toastText.textContent = message;
      toast.className = `toast show ${isError ? 'error' : ''}`;
      
      setTimeout(() => {
        toast.classList.remove('show');
      }, 3000);
    }

    // Update Server Display
    function updateServerDisplay() {
      activeCount.innerHTML = `<i class="fas fa-circle"></i> Active: ${currentServer.activeSessions}`;
      capacityDisplay.innerHTML = `<i class="fas fa-users"></i> Capacity: ${currentServer.activeSessions}/${currentServer.maxSessions}`;
      
      if (currentServer.isFull) {
        serverCard.style.borderColor = 'rgba(255, 107, 107, 0.2)';
        generateBtn.disabled = true;
        generateBtn.style.opacity = '0.7';
      } else {
        serverCard.style.borderColor = 'rgba(76, 201, 240, 0.2)';
        generateBtn.disabled = false;
        generateBtn.style.opacity = '1';
      }
    }

    // Show Error
    function showError(message) {
      codeBox.className = 'code-box has-error';
      codeBox.innerHTML = `<div class="error-message"><i class="fas fa-exclamation-circle"></i>${message}</div>`;
      copyBtn.style.display = 'none';
    }

    // Show Code
    function showCode(code) {
      currentCode = code;
      codeBox.className = 'code-box has-code';
      codeBox.innerHTML = `<div class="code-value">${code}</div>`;
      copyBtn.style.display = 'flex';
    }

    // Reset Code Box
    function resetCodeBox() {
      codeBox.className = 'code-box';
      codeBox.innerHTML = '<div class="code-placeholder">Code will appear here</div>';
      copyBtn.style.display = 'none';
      currentCode = null;
    }

    // Load Sessions
    async function loadSessions() {
      if (isLoadingSessions) return;
      
      try {
        isLoadingSessions = true;
        refreshBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
        
        const response = await axios.get(`${currentServer.url}../sessions`, {
          timeout: 8000
        });
        
        const sessions = response.data.sessions || [];
        const runningSessions = sessions.filter(s => s.running).length;
        
        // Update server state
        currentServer.activeSessions = runningSessions;
        currentServer.isFull = runningSessions >= currentServer.maxSessions;
        
        updateServerDisplay();
        
        // Display sessions
        if (sessions.length === 0) {
          sessionsList.innerHTML = '<div style="text-align: center; padding: 20px; color: #a0a8c0;"><i class="fas fa-inbox"></i> No active sessions</div>';
        } else {
          let html = '';
          sessions.forEach(session => {
            const isRunning = session.running || false;
            const sessionId = session.id || 'Unknown';
            html += `
              <div class="session-item">
                <span class="session-id">${sessionId}</span>
                <span class="status-badge ${isRunning ? 'status-running' : ''}">
                  ${isRunning ? 'Running' : 'Stopped'}
                </span>
              </div>
            `;
          });
          sessionsList.innerHTML = html;
        }
        
      } catch (error) {
        console.error('Error loading sessions:', error);
        sessionsList.innerHTML = '<div style="text-align: center; padding: 20px; color: #ff6b6b;"><i class="fas fa-exclamation-circle"></i> Cannot load sessions</div>';
        showToast('Failed to load sessions', true);
      } finally {
        isLoadingSessions = false;
        refreshBtn.innerHTML = '<i class="fas fa-sync-alt"></i>';
      }
    }

    // Generate Code
    async function generatePairCode(e) {
      e.preventDefault();
      
      if (currentServer.isFull) {
        showError('Server is full. Please try again later.');
        showToast('Server full - try again later', true);
        return;
      }
      
      const phoneNumber = phoneInput.value.trim();
      
      if (!validatePhone(phoneNumber)) {
        showError('Invalid phone number format');
        showToast('Invalid phone number', true);
        return;
      }
      
      // Show loading
      generateBtn.style.display = 'none';
      loading.style.display = 'block';
      resetCodeBox();
      
      try {
        const response = await axios.get(`${currentServer.url}${phoneNumber}`, {
          timeout: 45000
        });
        
        if (response.data.ok && response.data.code) {
          showCode(response.data.code);
          showToast('Code generated successfully!');
          
          // Try to start session
          try {
            await axios.get(`${currentServer.url}../start/${phoneNumber}`, {
              timeout: 5000
            });
          } catch (e) {
            // Ignore start errors
          }
          
          // Refresh sessions
          setTimeout(() => loadSessions(), 1000);
          
        } else {
          throw new Error(response.data.error || 'Generation failed');
        }
        
      } catch (error) {
        console.error('Generation error:', error);
        let errorMsg = 'Failed to generate code';
        if (error.response?.data?.error) {
          errorMsg = error.response.data.error;
        } else if (error.message.includes('timeout')) {
          errorMsg = 'Request timeout - try again';
        }
        showError(errorMsg);
        showToast('Generation failed', true);
      } finally {
        generateBtn.style.display = 'flex';
        loading.style.display = 'none';
      }
    }

    // Copy Code
    async function copyCode() {
      if (!currentCode) return;
      
      try {
        await navigator.clipboard.writeText(currentCode);
        
        const originalHTML = copyBtn.innerHTML;
        copyBtn.innerHTML = '<i class="fas fa-check"></i> Copied!';
        copyBtn.disabled = true;
        
        showToast('Code copied!');
        
        setTimeout(() => {
          copyBtn.innerHTML = originalHTML;
          copyBtn.disabled = false;
        }, 2000);
        
      } catch (error) {
        showToast('Copy failed', true);
      }
    }

    // Event Listeners
    form.addEventListener('submit', generatePairCode);
    copyBtn.addEventListener('click', copyCode);
    refreshBtn.addEventListener('click', loadSessions);

    phoneInput.addEventListener('input', (e) => {
      e.target.value = e.target.value.replace(/[^\d]/g, '');
    });

    phoneInput.addEventListener('focus', () => {
      if (codeBox.classList.contains('has-error')) {
        resetCodeBox();
      }
    });

    // Initialize
    document.addEventListener('DOMContentLoaded', () => {
      updateServerDisplay();
      loadSessions();
      
      // Refresh every 30 seconds
      setInterval(loadSessions, 30000);
    });
  </script>
</body>
</html>
